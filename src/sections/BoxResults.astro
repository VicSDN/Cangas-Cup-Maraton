---
import { supabase } from "../db/supabase";

let { data: match, error } = await supabase.from("match").select("*");
let { data: team } = await supabase.from("team").select("*");

function findTeam(teamId) {
  const teamAux = team.find((t) => t.id === teamId);
  return teamAux;
}

function formatDateTime(dateString) {
  const date = new Date(dateString);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, "0"); // Months are zero-based
  const day = String(date.getDate()).padStart(2, "0");
  const hours = String(date.getHours()).padStart(2, "0");
  const minutes = String(date.getMinutes()).padStart(2, "0");
  return `${day}/${month}/${year} ${hours}:${minutes}`;
}
---

<section
  class={`
  w-full max-w-[1400px]
  grid lg:grid-rows-10 auto-rows-[auto] gap-4
  mx-auto items-center p-6 md:p-12 lg:p-20
`}
>
  {
    match.map((match) =>
      match.finished === true ? (
        <article
          class={`
        w-full bg-whit
        relative rounded-xl
        backdrop-blur-md
        border border-black/10
        shadow-inner shadow-white/10
        overflow-hidden bg-slate-900
        group
      `}
        >
          <div class="relative z-20 flex h-full flex-row items-center justify-between p-4 text-lg md:p-6">
            <span>{findTeam(match.id_team1).name}</span>
            <span>{match.goals_team1}</span>
            <span>-</span>
            <span>{match.goals_team2}</span>
            <span>{findTeam(match.id_team2).name}</span>
          </div>
        </article>
      ) : (
        <article
          class={`
        w-full bg-whit
        relative rounded-xl
        backdrop-blur-md
        border border-black/10
        shadow-inner shadow-white/10
        overflow-hidden bg-slate-900
        group
      `}
        >
          <div class="relative z-20 flex h-full flex-row items-center justify-between p-4 text-lg md:p-6">
            <span>{findTeam(match.id_team1).name}</span>
            <span>{formatDateTime(match.day)}</span>
            <span>{findTeam(match.id_team2).name}</span>
          </div>
        </article>
      )
    )
  }
</section>
